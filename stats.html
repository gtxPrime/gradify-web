<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Study Stats â€“ Gradify</title>
  <link rel="stylesheet" href="css/variables.css" />
  <link rel="stylesheet" href="css/base.css" />
  <link rel="stylesheet" href="css/components.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <link rel="icon" type="image/webp" href="assets/icons/ic_launcher.webp" />
  <style>
    .stats-layout { max-width: 1100px; margin: 0 auto; padding-top: calc(var(--nav-height) + 24px); padding-bottom: 40px; padding-left: 20px; padding-right: 20px; }

    /* â”€â”€ Hero cards â”€â”€ */
    .stat-hero-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 16px; }
    @media(max-width:600px) { .stat-hero-grid { grid-template-columns: 1fr 1fr; } }
    .stat-hero-card {
      background: var(--color-card-bg); border-radius: 16px;
      padding: 16px 12px; text-align: center;
    }
    .stat-hero-card:first-child { background: var(--color-tray-bg); color: var(--color-main-bg); }
    .stat-hero-val { font-size: 24px; font-weight: 800; line-height: 1; display: block; margin: 6px 0 2px; }
    .stat-hero-label { font-size: 10px; opacity: 0.55; text-transform: uppercase; letter-spacing: 0.6px; }

    /* â”€â”€ Shared card â”€â”€ */
    .chart-card {
      background: var(--color-card-bg); border-radius: 20px;
      padding: 18px 18px; margin-bottom: 16px;
    }
    .chart-title { font-size: 14px; font-weight: 700; margin-bottom: 14px; }

    /* â”€â”€ Android-style period toggle â”€â”€ */
    .period-toggle-row {
      display: flex; align-items: center; gap: 10px; margin-bottom: 16px;
    }
    .view-toggle {
      display: flex; background: var(--color-email-pill-bg);
      border-radius: 12px; padding: 3px; gap: 2px; flex: 1;
    }
    .view-btn {
      flex: 1; padding: 7px 4px; border: none; border-radius: 10px;
      font-size: 12px; font-weight: 600; cursor: pointer;
      background: transparent; color: var(--color-text-icons); opacity: 0.5;
      transition: all 0.2s;
    }
    .view-btn.active { background: var(--color-tray-bg); color: var(--color-main-bg); opacity: 1; }

    .nav-arrow {
      width: 34px; height: 34px; border-radius: 50%; border: 1.5px solid var(--color-divider);
      background: var(--color-card-bg); display: flex; align-items: center; justify-content: center;
      cursor: pointer; flex-shrink: 0; transition: background 0.15s;
    }
    .nav-arrow:hover { background: var(--color-hero-cards); }
    .nav-arrow svg { display: block; }

    .stats-date-label {
      text-align: center; font-size: 13px; font-weight: 700;
      opacity: 0.65; margin-bottom: 14px; letter-spacing: 0.3px;
    }

    /* â”€â”€ Donut â”€â”€ */
    .donut-wrap {
      position: relative;
      width: clamp(160px, 28vw, 220px);
      height: clamp(160px, 28vw, 220px);
      margin: 0 auto 20px;
    }
    #donutChart { width: 100% !important; height: 100% !important; }
    #donutCenter {
      position: absolute; inset: 0;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      pointer-events: none;
    }
    #donutCenterTitle { font-size: 11px; opacity: 0.5; text-transform: uppercase; letter-spacing: 0.5px; }
    #donutCenterValue { font-size: 30px; font-weight: 800; line-height: 1.1; color: var(--color-text-icons); }
    #donutEmpty { text-align: center; padding: 20px; font-size: 13px; opacity: 0.4; display: none; }

    /* â”€â”€ Subject stats list â”€â”€ */
    .subj-stat-row {
      background: var(--color-main-bg); border-radius: 14px;
      padding: 12px 14px; margin-bottom: 10px; cursor: pointer;
      border: 1.5px solid transparent; transition: border-color 0.2s, background 0.2s;
    }
    .subj-stat-row:hover { background: var(--color-email-pill-bg); }
    .subj-stat-row.selected { border-color: var(--color-tray-bg); background: var(--color-email-pill-bg); }
    .subj-stat-header { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .subj-color-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
    .subj-name { font-size: 13px; font-weight: 700; flex: 1; }
    .subj-total-time { font-size: 13px; font-weight: 700; opacity: 0.65; }
    .subj-bar-row { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; }
    .subj-bar-label { font-size: 11px; opacity: 0.5; min-width: 48px; }
    .subj-bar-track { flex: 1; height: 6px; background: var(--color-email-pill-bg); border-radius: 99px; overflow: hidden; }
    .subj-bar-fill { height: 100%; border-radius: 99px; width: 0%; }
    .subj-bar-pct { font-size: 10px; opacity: 0.5; min-width: 28px; text-align: right; font-variant-numeric: tabular-nums; }
    .subj-times-row { display: flex; gap: 14px; margin-top: 6px; font-size: 11px; opacity: 0.5; }

    /* â”€â”€ Bar chart â”€â”€ */
    .chart-canvas { width: 100% !important; height: 180px !important; }
    .chart-period-tabs { display: flex; gap: 6px; }
    .period-tab {
      padding: 5px 14px; border-radius: 99px;
      font-size: 12px; font-weight: 600; cursor: pointer;
      border: 1.5px solid var(--color-divider); background: var(--color-card-bg);
      transition: all 0.2s;
    }
    .period-tab.active { background: var(--color-tray-bg); color: var(--color-main-bg); border-color: transparent; }

    /* â”€â”€ Heatmap â”€â”€ */
    .heatmap-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-top: 8px; }
    .heatmap-cell { aspect-ratio: 1; border-radius: 4px; background: var(--color-email-pill-bg); cursor: pointer; transition: transform 0.15s; }
    .heatmap-cell:hover { transform: scale(1.25); }
    .heatmap-cell.l1 { background: #DDE89D; }
    .heatmap-cell.l2 { background: #A8C66C; }
    .heatmap-cell.l3 { background: #739E4D; }
    .heatmap-cell.l4 { background: #22333B; }
    .heatmap-days { display: flex; justify-content: space-around; font-size: 9px; opacity: 0.4; margin-bottom: 4px; }
  </style>
</head>
<body>
<div class="page-loader" id="pageLoader"><div class="loader-logo"><span style="color:var(--color-glow)">G</span>radify</div><div class="spinner"></div></div>
<div class="toast-container" id="toastContainer"></div>
<div class="sidebar-overlay" id="sidebarOverlay"></div>
<nav class="sidebar" id="sidebar">
  <div class="sidebar-header"><div style="font-size:22px;font-weight:700"><span style="color:var(--color-hero-cards)">G</span><span style="color:var(--color-main-bg)">radify</span></div></div>
  <div class="sidebar-profile" id="sidebarProfile" onclick="navigate('profile.html')"><div class="sidebar-profile-avatar"><img id="sidebarAvatar" src="" alt="Avatar" onerror="this.src='assets/icons/avatar-placeholder.svg'" /></div><div><div class="sidebar-profile-name" id="sidebarName">Hello!</div><div class="sidebar-profile-sub" id="sidebarEmail">Tap to manage account</div></div></div>
  <div class="sidebar-exam-countdown" id="sidebarExamCountdown">
    <div style="font-size:11px;font-weight:600;color:var(--color-hero-cards);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px">ğŸ“… Exam Countdown</div>
    <div class="exam-timer-row"><span style="font-size:11px;color:rgba(250,246,233,0.7)">Quiz 1</span><span class="badge badge-dark" id="q1Timer">â€¦</span></div>
    <div class="exam-timer-row"><span style="font-size:11px;color:rgba(250,246,233,0.7)">Quiz 2</span><span class="badge badge-dark" id="q2Timer">â€¦</span></div>
    <div class="exam-timer-row"><span style="font-size:11px;color:rgba(250,246,233,0.7)">End Term</span><span class="badge badge-dark" id="etTimer">â€¦</span></div>
  </div>
  <div class="sidebar-nav">
    <a class="sidebar-item" href="index.html"><span class="icon">ğŸ </span> Dashboard</a>
    <a class="sidebar-item" href="lectures.html"><span class="icon">ğŸ¬</span> Lectures</a>
    <a class="sidebar-item" href="pyq.html"><span class="icon">ğŸ“</span> PYQ Practice</a>
    <a class="sidebar-item" href="notes.html"><span class="icon">ğŸ—’ï¸</span> My Notes</a>
    <a class="sidebar-item" href="tools.html"><span class="icon">ğŸ§®</span> Tools</a>
    <a class="sidebar-item active" href="stats.html"><span class="icon">ğŸ“Š</span> Study Stats</a>
    <div class="sidebar-divider"></div>
    <a class="sidebar-item" href="settings.html"><span class="icon">âš™ï¸</span> Settings</a>
    <a class="sidebar-item" href="profile.html"><span class="icon">ğŸ‘¤</span> Profile</a>
    <a class="sidebar-item" href="developers.html"><span class="icon">ğŸ‘¨â€ğŸ’»</span> Developers</a>
  </div>
  <div class="sidebar-footer"><button class="btn btn-ghost btn-block" id="logoutBtn"><span>ğŸ”</span> <span id="logoutBtnText">Login / Sign Up</span></button></div>
</nav>
<header class="app-nav">
  <div style="display:flex;align-items:center;gap:10px">
    <button class="nav-icon-btn" onclick="history.back()" aria-label="Back">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <button class="nav-icon-btn" id="menuBtn" aria-label="Menu">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="18" x2="20" y2="18"/></svg>
    </button>
    <span style="font-weight:700;font-size:18px">ğŸ“Š Study Stats</span>
  </div>
  <div class="nav-actions">
    <div class="nav-avatar" onclick="navigate('profile.html')"><img id="navAvatar" src="" alt="Profile" onerror="this.src='assets/icons/avatar-placeholder.svg'" /></div>
  </div>
</header>

<main class="main-content stats-layout">

  <!-- Hero summary -->
  <div class="stat-hero-grid">
    <div class="stat-hero-card">
      <span class="stat-hero-label">Today</span>
      <span class="stat-hero-val" id="todayTotal">â€“</span>
    </div>
    <div class="stat-hero-card">
      <span class="stat-hero-label">This Week</span>
      <span class="stat-hero-val" id="weekTotal">â€“</span>
    </div>
    <div class="stat-hero-card">
      <span class="stat-hero-label">This Month</span>
      <span class="stat-hero-val" id="monthTotal">â€“</span>
    </div>
    <div class="stat-hero-card">
      <span class="stat-hero-label">All Time</span>
      <span class="stat-hero-val" id="allTimeTotal">â€“</span>
    </div>
  </div>

  <!-- Android-style Daily / Weekly / Monthly view -->
  <div class="chart-card">
    <h3 class="chart-title">ğŸ“š Subject Breakdown</h3>

    <!-- Period toggle + nav (mirrors Android view_selector_container + arrows) -->
    <div class="period-toggle-row">
      <button class="nav-arrow" id="btnPrev" aria-label="Previous">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
      </button>
      <div class="view-toggle">
        <button class="view-btn active" id="btnDaily">Daily</button>
        <button class="view-btn" id="btnWeekly">Weekly</button>
        <button class="view-btn" id="btnMonthly">Monthly</button>
      </div>
      <button class="nav-arrow" id="btnNext" aria-label="Next">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
      </button>
    </div>

    <!-- Selected date label (mirrors textViewSelectedDate) -->
    <div class="stats-date-label" id="statsDateLabel">Today</div>

    <!-- Donut pie chart (mirrors Android MPAndroidChart PieChart, hole=85%) -->
    <div class="donut-wrap">
      <canvas id="donutChart"></canvas>
      <div id="donutCenter">
        <span id="donutCenterTitle">Studied</span>
        <span id="donutCenterValue">â€“</span>
      </div>
    </div>

    <div id="donutEmpty">No study data for this period.<br/>Start a lecture session to see stats!</div>

    <!-- Subject list (mirrors SubjectStatsAdapter RecyclerView) -->
    <div id="subjectStatsList"></div>
  </div>

  <!-- Study time bar chart -->
  <div class="chart-card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
      <h3 class="chart-title" style="margin:0">ğŸ“ˆ Study Time</h3>
      <div class="chart-period-tabs" id="periodTabs">
        <button class="period-tab active" data-period="week">7 Days</button>
        <button class="period-tab" data-period="month">30 Days</button>
      </div>
    </div>
    <canvas id="studyChart" class="chart-canvas"></canvas>
  </div>

  <!-- PYQ Performance -->
  <div class="chart-card">
    <h3 class="chart-title">ğŸ“ PYQ Performance</h3>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;text-align:center">
      <div>
        <div style="font-size:26px;font-weight:800;color:var(--color-success)" id="pyqCorrect">â€“</div>
        <div style="font-size:11px;opacity:0.5">Correct</div>
      </div>
      <div>
        <div style="font-size:26px;font-weight:800;color:var(--color-error)" id="pyqWrong">â€“</div>
        <div style="font-size:11px;opacity:0.5">Wrong</div>
      </div>
      <div>
        <div style="font-size:26px;font-weight:800;color:var(--color-glow)" id="pyqAccuracy">â€“%</div>
        <div style="font-size:11px;opacity:0.5">Accuracy</div>
      </div>
    </div>
    <div class="progress-bar" style="margin-top:14px">
      <div class="progress-fill" id="pyqAccFill" style="width:0%"></div>
    </div>
    <div style="font-size:12px;opacity:0.45;text-align:center;margin-top:8px" id="pyqSessions">0 sessions</div>
  </div>

  <!-- Activity heatmap -->
  <div class="chart-card">
    <h3 class="chart-title">ğŸ”¥ Activity â€“ Last 5 Weeks</h3>
    <div class="heatmap-days"><span>S</span><span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span></div>
    <div class="heatmap-grid" id="heatmapGrid"></div>
    <div style="display:flex;align-items:center;gap:6px;margin-top:12px;font-size:11px;opacity:0.45">
      Less
      <div style="width:12px;height:12px;border-radius:3px;background:var(--color-email-pill-bg)"></div>
      <div style="width:12px;height:12px;border-radius:3px;background:#DDE89D"></div>
      <div style="width:12px;height:12px;border-radius:3px;background:#739E4D"></div>
      <div style="width:12px;height:12px;border-radius:3px;background:#22333B"></div>
      More
    </div>
  </div>

</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script type="module">
  import { initApp } from './js/app.js';
  initApp('stats');
</script>
<script type="module" src="js/stats.js"></script>
</body>
</html>
